# @package _global_

defaults:
  - COCO_YOLOv3
  - /attack/perturber@model.modules.perturber: default
  - /attack/perturber/initializer@model.modules.perturber.initializer: uniform
  - /attack/perturber/composer@model.modules.perturber.composer: color_jitter_random_affine_overlay
  - /attack/perturber/projector@model.modules.perturber.projector: range
  - /attack/optimizer@model.optimizer: sgd
  - /attack/gradient_modifier@model.gradient_modifier: lp_normalizer
  - override /callbacks: [perturbation_visualizer]

task_name: "COCO_YOLOv3_ShapeShifter"
tags: ["adv"]

trainer:
  # 117,266 training images, 1 epochs, batch_size=16, 7,329.125
  max_steps: 7330

callbacks:
  perturbation_visualizer:
    frequency: 500

datamodule:
  num_workers: 32
  ims_per_batch: 16

model:
  modules:
    perturber:
      size: [3, 416, 234]

      initializer:
        min: 0.49
        max: 0.51

      projector:
        min: 0.0
        max: 1.0

      composer:
        degrees: [-15, 15]
        translate: [0.25, 0.25]
        scale: [0.25, 0.75]
        shear: [-5, 5, -5, 5]
        brightness: 0.3
        contrast: 0.3
        saturation: 1.0
        hue: 0.1
        pixel_scale: 1.0
        clamp: [0, 1]

  freeze: "logits"

  optimizer:
    lr: 0.1

  gradient_modifier:
    p: inf

  training_sequence:
    seq005: perturber

    seq010:
      logits: ["perturber"]

  validation_sequence: ${.training_sequence}

  test_sequence: ${.validation_sequence}
