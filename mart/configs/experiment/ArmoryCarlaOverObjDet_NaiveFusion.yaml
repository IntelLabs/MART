# @package _global_

defaults:
  - /model/detection: faster_rcnn_naive_fusion
  - override /datamodule: armory_carla_over_objdet_perturbable_mask
  - override /model: torchvision_faster_rcnn
  - override /metric: average_precision
  - override /optimization: super_convergence
  - override /callbacks: [model_checkpoint, lr_monitor]

task_name: "ArmoryCarlaOverObjDet_NaiveFusion"
tags: ["evaluation"]
fit: false
extras:
  print_config: false

datamodule:
  ims_per_batch: 2
  world_size: 1
  train_dataset:
    modalities: ["rgb", "depth"]
  val_dataset:
    modalities: ["rgb", "depth"]
  test_dataset:
    modalities: ["rgb", "depth"]

optimized_metric: "test_metrics/map"

callbacks:
  model_checkpoint:
    monitor: "validation_metrics/map"
    mode: "max"

trainer:
  # 3,600 training images, batch_size=2, 6 epochs
  # max_steps = 3600 / 2 * 6
  max_steps: 10800
  # FIXME: "nms_kernel" not implemented for 'BFloat16', torch.ops.torchvision.nms().
  precision: 32

model:
  modules:
    losses_and_detections:
      model:
        # A generic pytorch weight loading mechanism.
        weights_fpath: ${paths.weights_dir}/carla_multimodal_naive_weights_eval6.pt

  optimizer:
    lr: 0.0125
    momentum: 0.9
    weight_decay: 1e-4
